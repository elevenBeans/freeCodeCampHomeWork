<!DOCTYPE html>
<html>
<head lang="zh-cn">
  <meta charset="utf-8">
  <meta name="description" content="">
  <meta name="keywords" content="">
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
  <title>RA Wikipedia Viewer</title>
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-siteapp"/>
  <script src="http://cdn.bootcss.com/jquery/2.1.4/jquery.min.js"></script>
</head>
<body>
<style>
  html, body{
    background:#000;
    height: 100%;
  }

  .content{
    width: 80%;
    height: 100%;
    margin: 0px auto;
    position: relative;
  }
  .content .content-Wrap{
    position: absolute;
    width: 100%;
    height: 400px;
    top:50%;
    transform: translate(0,-50%);
    text-align: center;
    color:white;
  }
  .content .content-Wrap .random a{
    color: white!important;
    text-decoration: none;
    font-size: 24px;
  }
  .content .content-Wrap input{
    width: 80%;
    font-size: 24px;
  }
  .content .content-Wrap ul {
    list-style-type:none;
    color:#000;
    padding: 0px;
    width: 80%;
    display: inline-block;
    background-color: #fff;
  }
  .content .content-Wrap ul li{
    padding: 9px 0px;
    border-bottom: 1px solid #eee;

  }
  .content .content-Wrap ul .title{
    font-size: 20px;
    font-weight: bold;
  }
  .content .content-Wrap ul .summary{
    text-align: left;
    padding: 0px 9px;
    max-height: 40px;
    overflow : hidden;
    text-overflow: ellipsis;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
  }
</style>

<div class="content">
  <div class="content-Wrap">
    <div id="random" class="random"><a href="https://en.wikipedia.org/wiki/Special:Random" target="_blank">Click here for a random article</a></div><br />
    <input type="text" id="title" />

  </div>
</div>

<script>

//  api.php?action=query&titles=Main%20Page&prop=revisions&rvprop=content&format=jsonfm [try in ApiSandbox]

$(document).ready(function(){
  
  var timer = null;
  
  $('#title').on('input',function(){
    if($('.content-Wrap ul')) $('.content-Wrap ul').remove();
    
    if (typeof timer === 'number') {
      clearTimeout(timer);
    };

    timer = setTimeout(function(){      
      //console.log('input:',$('#title').val());
      searchArticle($('#title').val());
    },1800);

  })



  function searchArticle(title){
    //https://en.wikipedia.org/w/api.php?callback=jQuery2140704077721983466_1488270434435&format=json&action=query&titles=jack&prop=revisions&rvprop=content&gsrlimit=6&_=1488270434436
    
    //https://en.wikipedia.org/w/api.php?format=json&action=query&generator=search&gsrnamespace=0&gsrlimit=2&prop=pageimages|extracts&pilimit=max&exintro&explaintext&exsentences=1&exlimit=max&gsrsearch=jason&callback=angular.callbacks._2
    $.ajax({
      url:'https://en.wikipedia.org/w/api.php',
      //url:'https://free-api.heweather.com/v5/now', 
      type: 'POST',
      data: {
        format: 'json',
        action: 'query',
        generator: 'search',
        gsrlimit: '6',
        prop: 'pageimages|extracts',
        pilimit: 'max',
        exlimit: 'max',
        gsrsearch: title
      },
      //headers: { 'Api-User-Agent': 'Example/1.0' },
      dataType: 'jsonp',
      success: function(data) {
        render(data);
      }
    });
  }

  function render(data){
    var _article = data.query && data.query.pages;
    var _articleArry = [];
    //console.log('article:::',_article);
    for (var key of Object.keys(_article)) {
      console.log(_article[key]);
      var temp = {
        title: _article[key].title,
        extract: _article[key].extract || 'no extract'
      };
      console.log('temp:',temp);
      _articleArry.push(temp);
    }
    
    console.log( "_articleArry::" + _articleArry);
    
    var result = '';
    var tmpl = article => `
        <li><div class="title">${article.title}</div><div class="summary">${article.extract}</div></li>
      `;

    _articleArry.map(function(article){
      return result += tmpl(article);
    });

    $('.content-Wrap').append(`<ul>${result}</ul>`);
  }

})

</script>
</body>
</html>
